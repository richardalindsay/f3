(function(){var a;a=angular.module("f3",["ngRoute","hljs"]),a.config(["$routeProvider",function(a){return a.when("/",{templateUrl:"partials/blog-page",controller:"blogController"}).when("/page/:page",{templateUrl:"partials/blog-page",controller:"blogController"}).when("/addPost",{templateUrl:"partials/edit-post",controller:"editPostController"}).when("/editPost/:_id",{templateUrl:"partials/edit-post",controller:"editPostController"})}]),a.controller("blogController",["$scope","blogService","$routeParams","$location",function(a,b,c,d){var e;return e=parseInt(c.page,10)||1,b.getBlog(e).then(function(c){var d;return d=c.data.data.pagination.rowCount,a.pagination={},a.pagination.paginationList=b.calcPagination(d,e),a.posts=c.data.data.posts}),a.goPage=function(a){return a?d.path("page/"+a):void 0}}]),a.controller("editPostController",["$scope","pageService","$routeParams","$location",function(a,b,c,d){return c._id?b.getPost(c._id).then(function(b){return a.form=b.data,a.form.header="Edit"}):(a.form={},a.form.header="Add"),a.editControls=[{role:"pre",content:"&lt;&gt"},{role:"undo",content:'<span class="glyphicon glyphicon-circle-arrow-left"></span>'},{role:"redo",content:'<span class="glyphicon glyphicon-repeat"></span>'},{role:"bold",content:'<span class="glyphicon glyphicon-bold"></span>'},{role:"italic",content:'<span class="glyphicon glyphicon-italic"></span>'},{role:"underline",content:"<u>A</u>"},{role:"strikethrough",content:"<strike>A</strike>"},{role:"justifyLeft",content:'<span class="glyphicon glyphicon-align-left"></span>'},{role:"justifyCenter",content:'<span class="glyphicon glyphicon-align-center"></span>'},{role:"justifyRight",content:'<span class="glyphicon glyphicon-align-right"></span>'},{role:"justifyFull",content:'<span class="glyphicon glyphicon-align-justify"></span>'},{role:"indent",content:'<span class="glyphicon glyphicon-indent-left"></span>'},{role:"outdent",content:'<span class="glyphicon glyphicon-indent-right"></span>'},{role:"insertUnorderedList",content:'<span class="glyphicon glyphicon-list"></span>'},{role:"insertOrderedList",content:'1<span class="glyphicon glyphicon-list"</span>'},{role:"h1",content:"h<sup>1</sup>"},{role:"h2",content:"h<sup>2</sup>"},{role:"p",content:"p"},{role:"subscript",content:"<sub>A</sub>"},{role:"superscript",content:"<sup>A</sup>"}],a.submit=function(){return a.form.content=a.prepareHighlight(a.form.content),a.form._id?b.putPost(a.form._id,a.form.title,a.form.content).then(function(){return d.path("/")}):b.postPost(a.form.title,a.form.content).then(function(){return d.path("/")})},a.deletePost=function(){return b.deletePost(a.form._id).then(function(){return d.path("/")})},a.formatText=function(a){return/h1|h2|p|pre/.test(a)?document.execCommand("formatBlock",!1,a):document.execCommand(a,!1,null)},a.prepareHighlight=function(a){var b,c;return/<pre>/.test(a)&&(b=/<pre>(.*?)<\/pre>/g,c=/<br>/g,a=a.replace(b,function(a){return a.replace(c,"\n")}).replace(/<pre>/g,"<div hljs no-escape><pre>").replace(/<\/pre>/g,"</pre></div>")),a}}]),a.factory("blogService",["$http",function(a){var b,c;return b=function(a,b){var c,d,e,f,g,h;for(d=[],e=Math.floor(a/10+1),d.push(1===b?{text:"<",className:"disabled"}:{text:"<",link:b-1}),c=f=g=b-4,h=b+5;h>=g?h>=f:f>=h;c=h>=g?++f:--f)(b-2>c&&4>=e-c||c>=b-2&&c>0&&d.length<=5)&&d.push(c===b?{text:c,className:"active"}:{text:c,link:c});return d.push(b===e?{text:">",className:"disabled"}:{text:">",link:b+1}),d},c=function(b){var c;return c=10*(b-1),a.get("http://localhost:3000/api/blog/10/"+c)},{getBlog:c,calcPagination:b}}]),a.factory("pageService",["$http",function(a){var b,c,d,e;return d=function(b,c){return a.post("http://localhost:3000/api/post/",{title:b,content:c})},c=function(b){return a.get("http://localhost:3000/api/post/"+b)},e=function(b,c,d){return a.put("http://localhost:3000/api/post/"+b,{title:c,content:d})},b=function(b){return a["delete"]("http://localhost:3000/api/post/"+b)},{postPost:d,getPost:c,putPost:e,deletePost:b}}]),a.filter("trustAsHtml",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),a.directive("contenteditable",function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){var e;if(d)return d.$render=function(){return b.html(d.$viewValue||"")},b.on("blur keyup change",function(){return a.$apply(e)}),e=function(){var a;return a=b.html(),c.stripBr&&"<br>"===a&&(a=""),d.$setViewValue(a)}}}}),a.directive("dynamic",["$compile",function(a){return{restrict:"A",replace:!0,link:function(b,c,d){return b.$watch(d.dynamic,function(d){return c.html(d),a(c.contents())(b)})}}}])}).call(this);